import{jsx as o}from"react/jsx-runtime";import{useState as e,useEffect as t,useRef as r}from"react";import{u as i}from"./context-LVpDfP2H.mjs";import{u as s,a as m}from"./get-is-unified-wallet-CNcx75Dp.mjs";import{V as n,a,b as c,t as p}from"./to-ui-error-CCqAdorW.mjs";import"@privy-io/js-sdk-core";import"tinycolor2";import"viem";import"./internal-context-Z-fyxadS.mjs";import"ofetch";import"@heroicons/react/24/outline/DevicePhoneMobileIcon";import"@heroicons/react/24/outline/FingerPrintIcon";import"@heroicons/react/24/outline/PhoneIcon";import"@heroicons/react/24/outline/ShieldCheckIcon";import"./ModalHeader-rCMpqA2a.mjs";import"styled-components";import"./useActiveWallet-RZ4w-uGq.mjs";import"zustand";import"react-device-detect";import"./prepareFundingModalData-DjTxAoJ1.mjs";import"eventemitter3";import"./events-context-CI0iqAXA.mjs";import"viem/utils";import"./getPublicClient-B4uPLKn-.mjs";import"./useWallets-DlGuNtGR.mjs";import"@heroicons/react/24/outline/ArrowLeftIcon";import"@heroicons/react/24/outline/ArrowRightIcon";import"@heroicons/react/24/outline/QuestionMarkCircleIcon";import"@heroicons/react/24/outline/XMarkIcon";import"./ScreenLayout-DF3DCKOK.mjs";import"./Screen-CV2tt2Ap.mjs";import"./index-Dq_xe9dz.mjs";import"./PinInput-3SLvbnQa.mjs";import"@heroicons/react/24/outline/CalendarIcon";import"@heroicons/react/24/outline/ExclamationTriangleIcon";import"./StackedContainer-B2vaEl56.mjs";import"./useGetTokenPrice-DERdsrmf.mjs";import"./useGetSolPrice-DwwjjGbd.mjs";import"./index-DNz_w3-G.mjs";import"uuid";import"jose";import"@coinbase/wallet-sdk";import"@privy-io/ethereum";import"mipd";import"@privy-io/popup";import"./paths-3HW55qZg.mjs";import"./usePrivy-Dj52a5sp.mjs";import"@scure/base";import"@headlessui/react";import"@walletconnect/ethereum-provider";import"@privy-io/urls";import"js-cookie";import"./frame-uzTmvtww.mjs";import"@privy-io/routes";import"x402/client";import"@privy-io/api-base";import"viem/accounts";import"./use-sign-with-user-signer-Do5Oi_rb.mjs";import"./getEmbeddedConnectedWallet-CM6cDQCS.mjs";import"./TransactionDetails-BP142O9n.mjs";import"./WalletLink-CN4enmsE.mjs";import"./ethers-BQ45eiVv.mjs";import"./getFormattedUsdFromLamports-B6EqSEho.mjs";import"./transaction-CnfuREWo.mjs";import"./Layouts-BlFm53ED.mjs";import"@heroicons/react/24/outline/ChevronDownIcon";const l={component:()=>{let{user:l}=s(),u=i(),d=l?.mfaMethods.filter((o=>"passkey"!==o||!u.globalDisablePasskeys))??[],{data:h}=m(),[f,j]=e(d[0]),[v,y]=e(!1),[k,g]=e(),[w,C]=e();if(t((()=>{j(d[0])}),[d]),!h?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:b,onSuccess:I,generateOptions:M,verifyTotpCode:S,verifyPasskey:P,verifySmsCode:x,sendSmsCode:A}=h.mfaVerify,E=async o=>{if("passkey"!==o)try{j(o),"sms"===o&&(j(o),await A()),"totp"===o&&j(o)}catch(o){console.error(o)}else try{j(o);let e=await M();if(!e)throw Error("something went wrong");g(e),await P(e),y(!0),C(void 0),I()}catch(o){C(p(o))}},B=async o=>{C(void 0);try{if(!o||!f)return;if("passkey"===f){if(!k)throw Error("Missing passkey challenge");await P(k)}else"sms"===f?await x(o):"totp"===f&&await S(o);C(void 0),y(!0),I()}catch(o){throw p(o).error}},F=()=>{w||!v?b(w?.error??Error("Canceled MFA verification.")):I()},L=r(!1);return t((()=>{!L.current&&f&&(L.current=!0,E(f).finally((()=>{L.current=!1})))}),[open]),l?"passkey"===f?/*#__PURE__*/o(n,{account:l.linkedAccounts.filter((o=>"passkey"===o.type&&o.enrolledInMfa)).sort(((o,e)=>e.firstVerifiedAt.valueOf()-o.firstVerifiedAt.valueOf()))[0],submitSuccess:v,hasBlockingError:w?.isBlocking??!1,error:w?.error,onClose:F,onBack:()=>{j(void 0),C(void 0)},handleSubmit:()=>B(k).catch(C)}):"sms"===f||"totp"===f?/*#__PURE__*/o(a,{selectedMethod:f,submitSuccess:v,hasBlockingError:w?.isBlocking??!1,handleSubmitCode:B,onClose:F,onBack:d.length>1?()=>j(void 0):void 0}):/*#__PURE__*/o(c,{mfaMethods:d,onSelect:E,handleClose:F}):null}};export{l as MfaAuthVerifyFlowScreen,l as default};
