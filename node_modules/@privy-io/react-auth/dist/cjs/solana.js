"use strict";var e=require("react"),t=require("./usePrivy-Bx2PKTrU.js"),s=require("./context-BeSQM-Ma.js"),i=require("./events-context-Di6--rDg.js"),n=require("./internal-context-BJv4f_bO.js"),a=require("./get-is-unified-wallet-BwdzQwn_.js"),r=require("@solana/kit"),o=require("./useSolanaRpcClient-CYMWkK7E.js"),l=require("./useWallets-BwB7ALB8.js"),c=require("@scure/base"),d=require("@solana-program/memo"),u=require("./use-export-wallet-C9HWu0Dq.js"),h=require("./prepareFundingModalData-DDf6xLze.js"),p=require("@wallet-standard/app"),g=require("@walletconnect/universal-provider"),v=require("react-device-detect");require("react/jsx-runtime"),require("@privy-io/js-sdk-core"),require("./useWallets-DMyuB5aJ.js"),require("tinycolor2"),require("ofetch"),require("viem"),require("eventemitter3"),require("./use-sign-with-user-signer-Cu_6Bx7m.js");function f(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var y=0;function b(e){return"__private_"+y+++"_"+e}var w=/*#__PURE__*/b("_address"),m=/*#__PURE__*/b("_publicKey"),_=/*#__PURE__*/b("_chains"),P=/*#__PURE__*/b("_features"),T=/*#__PURE__*/b("_label"),S=/*#__PURE__*/b("_icon");class j{get address(){return f(this,w)[w]}get publicKey(){return f(this,m)[m].slice()}get chains(){return f(this,_)[_].slice()}get features(){return f(this,P)[P].slice()}get label(){return f(this,T)[T]}get icon(){return f(this,S)[S]}constructor({address:e,publicKey:t,label:s,icon:i}){Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),f(this,w)[w]=e,f(this,m)[m]=t,f(this,_)[_]=l.SOLANA_CHAINS,f(this,P)[P]=["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"],f(this,T)[T]=s,f(this,S)[S]=i}}function O(e){if("string"==typeof e)return c.base58.decode(e);if(e instanceof Uint8Array)return e;let t=e.signature;return"string"==typeof t?c.base58.decode(t):t}function A(e){if("string"==typeof e){try{return c.base58.decode(e)}catch{}return c.base64.decode(e)}if(e instanceof Uint8Array)return e;let t=e.transaction??e.signature;if(!t)throw Error("Invalid result from signTransaction or signAndSendTransaction attempt");if("string"==typeof t){try{return c.base58.decode(t)}catch{}return c.base64.decode(t)}return t}function W(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var C=0;function E(e){return"__private_"+C+++"_"+e}let q="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",M="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1";var x=/*#__PURE__*/E("_listeners"),k=/*#__PURE__*/E("_version"),U=/*#__PURE__*/E("_name"),I=/*#__PURE__*/E("_icon"),F=/*#__PURE__*/E("_provider"),N=/*#__PURE__*/E("_accounts"),L=/*#__PURE__*/E("_privyAppName"),R=/*#__PURE__*/E("_walletConnectCloudProjectId"),D=/*#__PURE__*/E("_walletEntry"),K=/*#__PURE__*/E("_onDisplayUriCallback"),B=/*#__PURE__*/E("_providerEventListeners"),V=/*#__PURE__*/E("_on"),G=/*#__PURE__*/E("_emit"),z=/*#__PURE__*/E("_off"),J=/*#__PURE__*/E("_connected"),Y=/*#__PURE__*/E("_disconnected"),H=/*#__PURE__*/E("_connect"),Z=/*#__PURE__*/E("_disconnect"),$=/*#__PURE__*/E("_signMessage"),Q=/*#__PURE__*/E("_signAndSendTransaction"),X=/*#__PURE__*/E("_signTransaction"),ee=/*#__PURE__*/E("_getOrCreateProvider"),te=/*#__PURE__*/E("_getOrCreateSession"),se=/*#__PURE__*/E("_restoreSession"),ie=/*#__PURE__*/E("_addProviderEventListener"),ne=/*#__PURE__*/E("_destroySession"),ae=/*#__PURE__*/E("_makeRpcRequest"),re=/*#__PURE__*/E("_onDisplayUri"),oe=/*#__PURE__*/E("_onSessionDelete");class le{get version(){return W(this,k)[k]}get name(){return W(this,U)[U]}get icon(){return W(this,I)[I]}get chains(){return l.SOLANA_CHAINS.slice()}get features(){return{"standard:connect":{version:"1.0.0",connect:W(this,H)[H]},"standard:disconnect":{version:"1.0.0",disconnect:W(this,Z)[Z]},"standard:events":{version:"1.0.0",on:W(this,V)[V]},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:W(this,Q)[Q]},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:W(this,X)[X]},"solana:signMessage":{version:"1.0.0",signMessage:W(this,$)[$]}}}get accounts(){return W(this,N)[N].slice()}get isWalletConnectSolana(){return!0}async initialize({walletConnectCloudProjectId:e,privyAppName:t}){W(this,R)[R]=e,W(this,L)[L]=t,await W(this,ee)[ee](),await W(this,se)[se]()}setWalletEntry(e,t){W(this,D)[D]=e,W(this,K)[K]=t}constructor(){Object.defineProperty(this,G,{value:ce}),Object.defineProperty(this,z,{value:de}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:void 0}),Object.defineProperty(this,U,{writable:!0,value:void 0}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,F,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,R,{writable:!0,value:void 0}),Object.defineProperty(this,D,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,Z,{writable:!0,value:void 0}),Object.defineProperty(this,$,{writable:!0,value:void 0}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),W(this,x)[x]={},W(this,k)[k]="1.0.0",W(this,U)[U]="WalletConnect",W(this,I)[I]=h.WALLET_CONNECT_LOGO_DATA_URI,W(this,F)[F]=null,W(this,N)[N]=[],W(this,L)[L]="",W(this,R)[R]="",W(this,B)[B]=new Map,W(this,V)[V]=(e,t)=>(W(this,x)[x][e]?.push(t)||(W(this,x)[x][e]=[t]),()=>W(this,z)[z](e,t)),W(this,J)[J]=e=>{W(this,U)[U]=W(this,F)[F]?.session?.peer?.metadata?.name||W(this,D)[D]?.name||"WalletConnect",W(this,I)[I]=W(this,F)[F]?.session?.peer?.metadata?.icons?.[0]||W(this,D)[D]?.image_url?.sm||W(this,I)[I],W(this,N)[N]=e.map((e=>new j({address:e,publicKey:c.base58.decode(e),label:W(this,U)[U],icon:W(this,I)[I]}))),W(this,G)[G]("change",{accounts:this.accounts})},W(this,Y)[Y]=()=>{W(this,N)[N]=[],W(this,G)[G]("change",{accounts:this.accounts})},W(this,H)[H]=async()=>(this.accounts.length||await W(this,te)[te](),{accounts:this.accounts}),W(this,Z)[Z]=async()=>{await W(this,ne)[ne](),W(this,G)[G]("change",{accounts:this.accounts})},W(this,$)[$]=async(...e)=>{let t=[];for(let{account:s,message:i}of e){let e=c.base58.encode(i);try{let n=await W(this,ae)[ae]("solana_signMessage",{message:e,pubkey:s.address},he("solana:mainnet"));t.push({signedMessage:i,signature:O(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await W(this,ae)[ae]("solana:signMessage",{message:e,pubkey:s.address},he("solana:mainnet"));t.push({signedMessage:i,signature:O(n)})}throw n}}return t},W(this,Q)[Q]=async(...e)=>{let t=[];for(let{account:s,chain:i,transaction:n,options:a}of e){let e=c.base64.encode(n);try{let n=await W(this,ae)[ae]("solana_signAndSendTransaction",{transaction:e,pubkey:s.address,sendOptions:a},he(i));t.push({signature:O(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await W(this,ae)[ae]("solana:signAndSendTransaction",{transaction:e,pubkey:s.address,sendOptions:a},he(i));t.push({signature:O(n)})}}}return t},W(this,X)[X]=async(...e)=>{let t=[];for(let{account:s,chain:i,transaction:n}of e){let e=c.base64.encode(n);try{let n=await W(this,ae)[ae]("solana_signTransaction",{transaction:e,pubkey:s.address},he(i||"solana:mainnet"));t.push({signedTransaction:A(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await W(this,ae)[ae]("solana:signTransaction",{transaction:e,pubkey:s.address},he(i||"solana:mainnet"));t.push({signedTransaction:A(n)})}}}return t},W(this,ee)[ee]=async()=>{if(W(this,F)[F])return W(this,F)[F];if(!W(this,R)[R])throw Error("WalletConnect Cloud Project ID is required");return W(this,F)[F]=await g.UniversalProvider.init({projectId:W(this,R)[R],metadata:{name:W(this,L)[L],description:W(this,L)[L],url:window.location.origin,icons:[]},relayUrl:"wss://relay.walletconnect.com",telemetryEnabled:!1}),W(this,ie)[ie]("display_uri",W(this,re)[re]),W(this,ie)[ie]("session_delete",W(this,oe)[oe]),W(this,ie)[ie]("session_ping",(()=>{})),W(this,ie)[ie]("session_event",(()=>{})),W(this,ie)[ie]("session_update",(()=>{})),W(this,F)[F]},W(this,te)[te]=async()=>{if(!W(this,F)[F])throw Error("WalletConnectSolana: Failed to get or create session. Provider not initialized");if(W(this,F)[F].session)return W(this,F)[F].session;let e=await W(this,F)[F].connect({optionalNamespaces:{solana:{chains:[q,M],methods:["solana_signMessage","solana_signTransaction","solana_signAndSendTransaction"],events:[]}}});if(!e)throw Error("WalletConnectSolana: Failed to create new session");return W(this,J)[J](ue(e)),e},W(this,se)[se]=async()=>{let e=W(this,F)[F]?.session;if(e){if(!e.namespaces?.solana)return await(W(this,F)[F]?.disconnect().catch((e=>console.error("WalletConnectSolana: Error disconnecting session",e)))),void(W(this,F)[F].session=void 0);W(this,J)[J](ue(e))}},W(this,ie)[ie]=(e,t)=>{let s=W(this,B)[B].get(e);s&&(W(this,F)[F]?.off(e,s),W(this,B)[B].delete(e)),W(this,F)[F]?.on(e,t),W(this,B)[B].set(e,t)},W(this,ne)[ne]=async()=>{try{if(W(this,F)[F]?.session&&await(W(this,F)[F]?.disconnect().catch((e=>console.error("WalletConnectSolana: Error disconnecting session",e)))),W(this,F)[F]?.client){let e=W(this,F)[F].client.proposal.getAll();await Promise.allSettled(e.map((e=>W(this,F)[F]?.client.proposal.delete(e.id,{code:6e3,message:"User disconnected"}))));let t=W(this,F)[F].client.pairing.getAll();await Promise.allSettled(t.map((e=>W(this,F)[F]?.client.pairing.delete(e.topic,{code:6e3,message:"User disconnected"}))))}W(this,Y)[Y]()}catch(e){console.error("WalletConnectSolana: Error destroying session",e)}},W(this,ae)[ae]=async(e,t,s)=>{try{return await W(this,F)[F].request({method:e,params:t},s)}catch(t){if(console.error(`WalletConnectSolana: RPC Error - ${e}:`,t),t?.message?.includes("without any listeners")&&t.result)return t.result;if(t?.message?.includes("session topic does not exist in keychain"))throw Error("WalletConnectSolana: Wallet connection lost. Please reconnect.");throw t}},W(this,re)[re]=e=>{if(v.isMobile&&W(this,D)[D]){let{redirect:s}=t.buildTargetUrl(e,W(this,D)[D]);null==W(this,K)[K]||W(this,K)[K].call(this,{native:s,universal:s})}else null==W(this,K)[K]||W(this,K)[K].call(this,{native:e,universal:void 0})},W(this,oe)[oe]=()=>{W(this,Y)[Y]()}}}function ce(e,...t){W(this,x)[x][e]?.forEach((e=>e.apply(null,t)))}function de(e,t){W(this,x)[x][e]=W(this,x)[x][e]?.filter((e=>t!==e))}function ue(e){return e.namespaces.solana.accounts.reduce(((e,t)=>{let s=t.split(":").at(-1);return e.includes(s)||e.push(s),e}),[])}function he(e){switch(e){case"solana:mainnet":return q;case"solana:devnet":return M;default:return e}}var pe={id:t.SOLANA_FUNDING_PLUGIN_ID,getSolanaRpcClient:o.getSolanaRpcClient,createTransactionFromRelayQuote:async function({solanaClient:e,quote:t,source:s}){let i=t.steps[0]?.items?.[0];if(!i)throw Error("Invalid quote");let n=i.data.instructions.map((({keys:e,programId:t,data:s})=>({accounts:e.map((({pubkey:e,isSigner:t,isWritable:s})=>({address:e,role:t&&s?3:t&&!s?2:!t&&s?1:0}))),programAddress:t,data:new Uint8Array(Buffer.from(s,"hex"))}))),{value:a}=await e.rpc.getLatestBlockhash().send(),o=r.pipe(r.createTransactionMessage({version:0}),(e=>r.setTransactionMessageFeePayerSigner({address:s},e)),(e=>r.setTransactionMessageLifetimeUsingBlockhash(a,e)),(e=>r.appendTransactionMessageInstructions(n,e)),(e=>r.compileTransaction(e)));return new Uint8Array(r.getTransactionEncoder().encode(o))},simulateTransaction:o.simulateTransaction,getAddressFromBuffer:l.getAddressFromBuffer,fetchTransactionEstimatedFees:o.fetchTransactionEstimatedFees};var ge={id:t.SOLANA_LEDGER_PLUGIN_ID,createSiwsMemoTransaction:({address:e,nonce:s})=>{let i=d.getAddMemoInstruction({memo:t.prepareSiwsMessageWithNonce({address:r.address(e),nonce:s})});return r.pipe(r.createTransactionMessage({version:"legacy"}),(t=>r.setTransactionMessageFeePayer(r.address(e),t)),(e=>r.setTransactionMessageLifetimeUsingBlockhash({blockhash:r.blockhash("GfVcyD5fWFJ6hRm8bsy7CoVPsLSoJhtJKRJYk8T2VVFN"),lastValidBlockHeight:0n},e)),(e=>r.appendTransactionMessageInstructions([i],e)),(e=>r.compileTransaction(e)),(e=>c.base64.encode(Uint8Array.from(r.getTransactionEncoder().encode(e)))))},getSignatureFromTransaction:(e,t)=>{let s=r.getTransactionDecoder().decode(e).signatures[t];if(!s)throw Error(`Missing transaction signature for address: ${t}`);return c.base64.encode(s)}};exports.useStandardWallets=l.useSolanaStandardWallets,exports.useWallets=l.useWallets,exports.useExportWallet=u.useExportWallet,exports.useFundWallet=u.useFundWallet,exports.SolanaAdapterConnector=h.SolanaWalletConnector,exports.toSolanaWalletConnectors=e=>{let t,{get:s,on:i}=p.getWallets(),n=e?.shouldAutoConnect??!0,a=new h.SolanaWalletConnector(new le,n),r=new Map,o=[];function l(...e){e.forEach((e=>{!(e.features["privy:"]&&"isPrivyWallet"in e&&e.isPrivyWallet||r.has(e.name))&&e.chains.some((e=>"string"==typeof e&&e.startsWith("solana:")))&&r.set(e.name,e)})),o=Array.from(r.values()).map((e=>new h.SolanaWalletConnector(e,n))).concat(a),t?.(o)}function c(...e){Array.from(r.values()).forEach((t=>!e.includes(t)&&r.delete(t.name))),o=Array.from(r.values()).map((e=>new h.SolanaWalletConnector(e,n))).concat(a),t?.(o)}let d=[i("register",l),i("unregister",c)];return l(...s()),{_setOnConnectorsUpdated:e=>{t=e},onMount:()=>{d[0]||(d[0]=i("register",l)),d[1]||(d[1]=i("unregister",c))},onUnmount:()=>{let e=d.pop();for(;e;)e(),e=d.pop()},get:()=>o}},exports.useCreateWallet=function(){let{create:e}=t.useCreateWalletInternal();return{createWallet:async t=>{t&&"target"in t&&t&&(t=void 0);let{account:s}=await e({chainType:"solana",options:t});return{wallet:s}}}},exports.useImportWallet=()=>{let{user:r}=a.usePrivyContext(),{client:o,refreshSessionAndUser:l,initializeWalletProxy:c}=n.usePrivyInternal(),d=i.useEmitPrivyEvent(),u=s.useAppConfig();return{importWallet:e.useCallback((({privateKey:e,additionalSigners:s})=>t.importWallet({getAccessToken:()=>o.getAccessToken(),user:r,initializeWalletProxy:c,refreshSessionAndUser:l,emitPrivyEvent:d,appConfig:u},{privateKey:e,chainType:"solana",additionalSigners:s})),[r,o,l,c,d,u])}},exports.useSignAndSendTransaction=function(){return{signAndSendTransaction:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signAndSendTransaction({...s,chain:s.chain||"solana:mainnet"}));return 1===e.length?t[0]:[...t]}}},exports.useSignMessage=function(){return{signMessage:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signMessage({...s,options:s.options}));return 1===e.length?t[0]:[...t]}}},exports.useSignTransaction=function(){return{signTransaction:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signTransaction({...s,chain:s.chain||"solana:mainnet"}));return 1===e.length?t[0]:[...t]}}},exports.useSolanaFundingPlugin=()=>t.useRegisterPlugin(pe),exports.useSolanaLedgerPlugin=()=>t.useRegisterPlugin(ge);
