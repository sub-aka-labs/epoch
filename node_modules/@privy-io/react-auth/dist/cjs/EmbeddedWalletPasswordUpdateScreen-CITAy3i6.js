"use strict";var e=require("react/jsx-runtime"),r=require("react"),t=require("./get-is-unified-wallet-BwdzQwn_.js"),s=require("./context-BeSQM-Ma.js"),o=require("./internal-context-BJv4f_bO.js"),a=require("./useWallets-DMyuB5aJ.js"),i=require("./SetWalletPasswordForm-Gkq-DskE.js");require("viem"),require("@privy-io/js-sdk-core"),require("tinycolor2"),require("ofetch"),require("@heroicons/react/24/outline/ExclamationTriangleIcon"),require("./Layouts-D3TOcPhm.js"),require("styled-components"),require("./ModalHeader-C5O9gNUP.js"),require("./useActiveWallet-vlXeDPzp.js"),require("zustand"),require("react-device-detect"),require("./prepareFundingModalData-DDf6xLze.js"),require("eventemitter3"),require("./events-context-Di6--rDg.js"),require("viem/utils"),require("./getPublicClient-BsmZyCGX.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./shared-BcueHfN-.js"),require("@heroicons/react/24/outline/ArrowPathIcon"),require("@heroicons/react/24/outline/EyeIcon"),require("@heroicons/react/24/outline/EyeSlashIcon"),require("./Checkbox-DzxHC5tk.js"),require("@heroicons/react/24/outline/KeyIcon"),require("@heroicons/react/24/solid/CheckCircleIcon"),require("fast-password-entropy"),require("secure-password-utilities"),require("secure-password-utilities/wordlists"),require("@heroicons/react/24/outline/ArrowDownTrayIcon"),require("@heroicons/react/24/outline/ClipboardDocumentCheckIcon"),require("@heroicons/react/24/outline/DocumentDuplicateIcon"),require("@heroicons/react/24/solid/XCircleIcon"),require("./ScreenHeader-CgYJ5Fmg.js");const n={component:()=>{let[n,d]=r.useState(null),[c,l]=r.useState(!1),[u,y]=r.useState(null),[v,w]=r.useState(""),{authenticated:h,user:p}=t.usePrivyContext(),{client:q,walletProxy:g,refreshSessionAndUser:m,closePrivyModal:P,createAnalyticsEvent:f}=o.usePrivyInternal(),{navigate:M,data:A,onUserCloseViaDialogOrKeybindRef:E}=t.usePrivyModal(),I=s.useAppConfig(),{onSuccess:_,onFailure:b}=A.setWalletPassword,C=t.getPrivyPrimaryWallet(p),S="user-passcode"===n?.recoveryMethod,j="user-passcode"===C?.recoveryMethod;r.useEffect((()=>{h||(M("LandingScreen"),b(new o.PrivyUnauthenticatedError("User must be authenticated before setting a password on a Privy wallet")))}),[h]);let x=()=>u?(b(u),void P({shouldCallAuthOnSuccess:!1})):S?(_(n),void P({shouldCallAuthOnSuccess:!1})):(b(new o.PrivyEmbeddedWalletError("Exited before password was added to wallet")),void P({shouldCallAuthOnSuccess:!1}));E.current=x;/*#__PURE__*/return e.jsx(i.SetWalletPasswordForm,{appName:I?.name||"privy",config:{initiatedBy:"user",onCancel:x},error:u?"An error has occurred, please try again.":void 0,buttonLoading:c,buttonHideAnimations:!1,password:v,isResettingPassword:j,onPasswordGenerate:()=>w(i.generatePassphrase()),onPasswordChange:w,onSubmit:async()=>{S?(_(n),P({shouldCallAuthOnSuccess:!1})):(l(!0),y(null),await(async()=>{let e=await q.getAccessToken();if(e&&p&&C?.address&&v&&g)try{f({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:j}});let{entropyId:r,entropyIdVerifier:s}=a.getEntropyDetailsForUser(p);if(!(await g.setRecovery({accessToken:e,entropyId:r,entropyIdVerifier:s,recoveryPassword:v,recoveryMethod:"user-passcode"})).entropyId)return y(new o.PrivyEmbeddedWalletError("Error setting password on privy wallet")),void f({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:j,reason:"error setting password"}});let i=await m(),n=t.getPrivyPrimaryWallet(i);if(!n)return y(new o.PrivyEmbeddedWalletError("Error setting password on privy wallet")),void f({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:j,reason:"wallet disconnected"}});d(n),f({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:C.address,existingRecoveryMethod:C.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:j}})}catch(e){console.warn(e),y(e instanceof Error?e:Error("Error setting password on privy wallet")),f({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:C.address,reason:e}})}})(),l(!1))},onClose:x})}};exports.EmbeddedWalletPasswordUpdateScreen=n,exports.default=n;
