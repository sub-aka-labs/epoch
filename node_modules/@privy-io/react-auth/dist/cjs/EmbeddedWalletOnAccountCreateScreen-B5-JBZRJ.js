"use strict";var e=require("react/jsx-runtime"),r=require("lucide-react"),t=require("react"),a=require("@privy-io/js-sdk-core"),i=require("./context-BeSQM-Ma.js"),l=require("./index-CzmnSRoa.js"),s=require("./internal-context-BJv4f_bO.js"),o=require("./get-is-unified-wallet-BwdzQwn_.js"),u=require("./ScreenLayout-BtVIYAso.js");require("tinycolor2"),require("uuid"),require("jose"),require("eventemitter3"),require("./useActiveWallet-vlXeDPzp.js"),require("zustand"),require("styled-components"),require("react-device-detect"),require("./prepareFundingModalData-DDf6xLze.js"),require("./events-context-Di6--rDg.js"),require("viem"),require("viem/utils"),require("./getPublicClient-BsmZyCGX.js"),require("./useWallets-DMyuB5aJ.js"),require("@coinbase/wallet-sdk"),require("@privy-io/ethereum"),require("mipd"),require("@privy-io/popup"),require("./paths-DizMb-lU.js"),require("./usePrivy-Bx2PKTrU.js"),require("@scure/base"),require("@headlessui/react"),require("@walletconnect/ethereum-provider"),require("@privy-io/urls"),require("ofetch"),require("js-cookie"),require("./frame-Oz7volks.js"),require("@privy-io/routes"),require("x402/client"),require("@privy-io/api-base"),require("viem/accounts"),require("./use-sign-with-user-signer-Cu_6Bx7m.js"),require("./getEmbeddedConnectedWallet-6TsVZJkD.js"),require("./ModalHeader-C5O9gNUP.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./Screen-BSwlHqPg.js"),require("./index-ByFhjjzH.js");const n=({errorMessage:t,onClose:a})=>t?/*#__PURE__*/e.jsx(u.ScreenLayout,{title:"Something went wrong",subtitle:t,icon:r.XCircle,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}):/*#__PURE__*/e.jsx(u.ScreenLayout,{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),c={component:()=>{let{setModalData:r,navigate:u,data:c,onUserCloseViaDialogOrKeybindRef:d}=o.usePrivyModal(),q=i.useAppConfig(),[y,h]=t.useState(""),{embeddedWallets:m}=i.useAppConfig(),{authenticated:w,user:p}=o.usePrivyContext(),{closePrivyModal:v,walletProxy:C,client:g}=s.usePrivyInternal(),{onSuccess:b,onFailure:j,callAuthOnSuccessOnClose:S,shouldCreateEth:W,shouldCreateSol:x}=c.createWallet,f="legacy-embedded-wallets-only"===q.embeddedWallets.mode&&!0===q?.embeddedWallets.requireUserOwnedRecoveryOnCreate,[E,A]=t.useState(null),{create:O}=l.useCreateWalletWithoutFallback(),I=W??(!!p&&l.shouldCreateEmbeddedEthWallet(p,q.embeddedWallets.ethereum.createOnLogin)),P=x??(!!p&&l.shouldCreateEmbeddedSolWallet(p,q.embeddedWallets.solana.createOnLogin)),k=new l.RunEffectOnce((async()=>{let e=await g.getAccessToken();if(p&&e&&C)try{let e,r=await a.generateWalletIdempotencyKey(p.id,"ethereum"),t=await a.generateWalletIdempotencyKey(p.id,"solana");if(I&&P)e=await O({chainType:"ethereum",walletIndex:0,latestUser:p,idempotencyKey:r}),e=await O({chainType:"solana",walletIndex:0,latestUser:e.user,idempotencyKey:t});else if(P)e=await O({chainType:"solana",walletIndex:0,latestUser:p,idempotencyKey:t});else{if(!I)return void v({shouldCallAuthOnSuccess:S});e=await O({chainType:"ethereum",walletIndex:0,latestUser:p,idempotencyKey:r})}A(e),u("EmbeddedWalletCreatedScreen")}catch(e){h(e.message)}}));return t.useEffect((()=>w&&p?f?(r({...c,createWallet:{...c.createWallet,shouldCreateEth:I,shouldCreateSol:P},recoverySelection:{...c?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:I,shouldCreateSol:P}}),u(l.toEmbeddedWalletSetRecoveryScreen({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:m.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void k.execute():(u("LandingScreen"),void j(Error("User must be authenticated before creating a Privy wallet")))),[f,w]),d.current=()=>null/*#__PURE__*/,e.jsx(n,{errorMessage:y||void 0,onClose:()=>{E?(b(E),v({shouldCallAuthOnSuccess:S})):(j(new s.PrivyEmbeddedWalletError("User wallet creation failed")),v({shouldCallAuthOnSuccess:!1}))}})}};exports.EmbeddedWalletOnAccountCreateScreen=c,exports.EmbeddedWalletOnAccountCreateView=n,exports.default=c;
