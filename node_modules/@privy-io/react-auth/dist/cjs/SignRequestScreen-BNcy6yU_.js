"use strict";var e=require("react/jsx-runtime"),r=require("@scure/base"),i=require("lucide-react"),t=require("react"),s=require("styled-components"),o=require("viem"),n=require("@privy-io/js-sdk-core"),a=require("./CopyToClipboard-BCe_l6_D.js"),l=require("./Layouts-D3TOcPhm.js"),c=require("./JsonTree-C28xtYM0.js"),u=require("./prepareFundingModalData-DDf6xLze.js"),d=require("./context-BeSQM-Ma.js"),p=require("./internal-context-BJv4f_bO.js"),g=require("./get-is-unified-wallet-BwdzQwn_.js"),y=require("./ScreenLayout-BtVIYAso.js");require("./copy-BiZ7dtqy.js"),require("eventemitter3"),require("tinycolor2"),require("ofetch"),require("./ModalHeader-C5O9gNUP.js"),require("./useActiveWallet-vlXeDPzp.js"),require("zustand"),require("react-device-detect"),require("./events-context-Di6--rDg.js"),require("viem/utils"),require("./getPublicClient-BsmZyCGX.js"),require("./useWallets-DMyuB5aJ.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./Screen-BSwlHqPg.js"),require("./index-ByFhjjzH.js");const x=s.styled.img`
  && {
    height: ${e=>"sm"===e.size?"65px":"140px"};
    width: ${e=>"sm"===e.size?"65px":"140px"};
    border-radius: 16px;
    margin-bottom: 12px;
  }
`;let h=e=>{if(!o.isHex(e))return e;try{let r=o.hexToString(e);return r.includes("�")?e:r}catch{return e}},q=e=>{try{let i=r.base64.decode(e),t=(new TextDecoder).decode(i);return t.includes("�")?e:t}catch{return e}},v=r=>{let{types:i,primaryType:t,...s}=r.typedData;/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(S,{data:s}),/*#__PURE__*/e.jsx(a.CopytoClipboardButton,{text:(o=r.typedData,JSON.stringify(o,null,2)),itemName:"full payload to clipboard"})," "]});var o};const m=({method:r,messageData:t,copy:s,iconUrl:o,isLoading:n,success:a,walletProxyIsLoading:c,errorMessage:u,isCancellable:d,onSign:p,onCancel:g,onClose:m})=>/*#__PURE__*/e.jsx(y.ScreenLayout,{title:s.title,subtitle:s.description,showClose:!0,onClose:m,icon:i.Edit,iconVariant:"subtle",helpText:u?/*#__PURE__*/e.jsx(C,{children:u}):void 0,primaryCta:{label:s.buttonText,onClick:p,disabled:n||a||c,loading:n},secondaryCta:d?{label:"Not now",onClick:g,disabled:n||a||c}:void 0,watermark:!0,children:/*#__PURE__*/e.jsxs(l.FixedGappedContainer,{children:[o?/*#__PURE__*/e.jsx(x,{style:{alignSelf:"center"},size:"sm",src:o,alt:"app image"}):null,/*#__PURE__*/e.jsxs(j,{children:["personal_sign"===r&&/*#__PURE__*/e.jsx(T,{children:h(t)}),"eth_signTypedData_v4"===r&&/*#__PURE__*/e.jsx(v,{typedData:t}),"solana_signMessage"===r&&/*#__PURE__*/e.jsx(T,{children:q(t)})]})]})}),E={component:()=>{let{authenticated:r}=g.usePrivyContext(),{initializeWalletProxy:i,closePrivyModal:s}=p.usePrivyInternal(),{navigate:o,data:a,onUserCloseViaDialogOrKeybindRef:l}=g.usePrivyModal(),[c,y]=t.useState(!0),[x,h]=t.useState(""),[q,v]=t.useState(),[E,j]=t.useState(null),[C,S]=t.useState(!1);t.useEffect((()=>{r||o("LandingScreen")}),[r]),t.useEffect((()=>{i(d.WALLET_PROXY_TIMEOUT).then((e=>{y(!1),e||(h("An error has occurred, please try again."),v(new u.PrivyProviderRpcError(new u.ProviderRpcError(x,n.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))))}))}),[]);let{method:T,data:R,confirmAndSign:b,onSuccess:P,onFailure:f,uiOptions:w}=a.signMessage,_={title:w?.title||"Sign message",description:w?.description||"Signing this message will not cost you any fees.",buttonText:w?.buttonText||"Sign and continue"},L=e=>{e?P(e):f(q||new u.PrivyProviderRpcError(new u.ProviderRpcError("The user rejected the request.",n.ProviderErrors.E4001_USER_REJECTED_REQUEST.eipCode))),s({shouldCallAuthOnSuccess:!1}),setTimeout((()=>{j(null),h(""),v(void 0)}),200)};l.current=()=>{L(E)};/*#__PURE__*/return e.jsx(m,{method:T,messageData:R,copy:_,iconUrl:w?.iconUrl&&"string"==typeof w.iconUrl?w.iconUrl:void 0,isLoading:C,success:null!==E,walletProxyIsLoading:c,errorMessage:x,isCancellable:w?.isCancellable,onSign:async()=>{S(!0),h("");try{let e=await b();j(e),S(!1),setTimeout((()=>{L(e)}),d.DEFAULT_SUCCESS_SCREEN_DURATION_MS)}catch(e){console.error(e),h("An error has occurred, please try again."),v(new u.PrivyProviderRpcError(new u.ProviderRpcError(x,n.ProviderErrors.E32603_DEFAULT_INTERNAL_ERROR.eipCode))),S(!1)}},onCancel:()=>L(null),onClose:()=>L(E)})}};let j=s.styled.div`
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 16px;
`,C=s.styled.p`
  && {
    margin: 0;
    width: 100%;
    text-align: center;
    color: var(--privy-color-error-dark);
    font-size: 14px;
    line-height: 22px;
  }
`,S=s.styled(c.DisplayJsonTree)`
  margin-top: 0;
`,T=s.styled(c.Message)`
  margin-top: 0;
`;exports.SignRequestScreen=E,exports.SignRequestView=m,exports.default=E;
