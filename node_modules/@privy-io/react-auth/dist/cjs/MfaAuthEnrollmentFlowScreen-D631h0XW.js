"use strict";var e=require("react/jsx-runtime"),r=require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),i=require("@heroicons/react/24/outline/ShieldCheckIcon"),o=require("react"),t=require("./ModalHeader-C5O9gNUP.js"),n=require("./useActiveWallet-vlXeDPzp.js"),s=require("./context-BeSQM-Ma.js"),a=require("./get-is-unified-wallet-BwdzQwn_.js"),u=require("./EnrollTotp-leOB_B4o.js"),l=require("./PinInput-B12fA7pp.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("styled-components"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./internal-context-BJv4f_bO.js"),require("ofetch"),require("zustand"),require("react-device-detect"),require("./prepareFundingModalData-DDf6xLze.js"),require("@privy-io/js-sdk-core"),require("eventemitter3"),require("./events-context-Di6--rDg.js"),require("viem"),require("viem/utils"),require("./getPublicClient-BsmZyCGX.js"),require("./useWallets-DMyuB5aJ.js"),require("tinycolor2"),require("@heroicons/react/24/outline/ChevronRightIcon"),require("@heroicons/react/24/outline/DevicePhoneMobileIcon"),require("@heroicons/react/24/outline/FingerPrintIcon"),require("@heroicons/react/24/outline/MinusCircleIcon"),require("@heroicons/react/24/outline/PhoneIcon"),require("./Chip-C6r7fZiR.js"),require("./LoadingSkeleton-BoyADunQ.js"),require("@heroicons/react/24/outline/ArrowRightEndOnRectangleIcon"),require("@heroicons/react/24/outline/ClockIcon"),require("./ErrorScreen-xNDIVXx8.js"),require("lucide-react"),require("./index-CzmnSRoa.js"),require("uuid"),require("jose"),require("@coinbase/wallet-sdk"),require("@privy-io/ethereum"),require("mipd"),require("@privy-io/popup"),require("./paths-DizMb-lU.js"),require("./usePrivy-Bx2PKTrU.js"),require("@scure/base"),require("@headlessui/react"),require("@walletconnect/ethereum-provider"),require("@privy-io/urls"),require("js-cookie"),require("./frame-Oz7volks.js"),require("@privy-io/routes"),require("x402/client"),require("@privy-io/api-base"),require("viem/accounts"),require("./use-sign-with-user-signer-Cu_6Bx7m.js"),require("./getEmbeddedConnectedWallet-6TsVZJkD.js"),require("./reservoir-Bx0HQwbb.js"),require("./ScreenLayout-BtVIYAso.js"),require("./Screen-BSwlHqPg.js"),require("./index-ByFhjjzH.js"),require("./LinkPasskeyScreen-o4qdrAL3.js"),require("./TodoList-Cii_KrAk.js"),require("./CopyToClipboard-BCe_l6_D.js"),require("./copy-BiZ7dtqy.js"),require("./Layouts-D3TOcPhm.js"),require("./Column-D8_5wTPp.js"),require("./LabelXs-C8rLnCfU.js"),require("./Subtitle-CR8zM7ZJ.js"),require("./Title-ifTy35V5.js"),require("./shared-DBm7PUrg.js"),require("@heroicons/react/24/solid/ShieldCheckIcon"),require("./QrCode-CLd3Ytk7.js"),require("qrcode");var d=/*#__PURE__*/c(r),h=/*#__PURE__*/c(i);const j={component:()=>{let{user:r,ready:i}=a.usePrivyContext(),{data:c,onUserCloseViaDialogOrKeybindRef:j}=a.usePrivyModal(),m=s.useAppConfig(),[q,y]=o.useState(null),[p,f]=o.useState(null),[v,x]=o.useState(null),[g,M]=o.useState(!1),[k,C]=o.useState(!1),[S,w]=o.useState(),b=async()=>{S?I(S):r?await F({user:r}):I(Error("Must be logged in to manage MFA")),setTimeout((()=>{y(null),f(null)}),500)};if(j.current=b,!c?.mfaEnroll)throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:I,onSuccess:F,onBack:P,mfaMethods:T,verify:E,generateTotpSecret:A,enrollTotp:R,unenrollTotp:L,enrollPasskey:B}=c.mfaEnroll,W=r?.mfaMethods.includes("sms"),H=r?.mfaMethods.includes("totp"),U=r?.mfaMethods.includes("passkey"),D=!!r?.phone,O=r?.linkedAccounts.filter((e=>"passkey"===e.type)).map((e=>e.credentialId))??[];function X(){y(null),f(null),w(void 0)}async function $(e=O){try{w(void 0),C(!0);let r=await B(e);return await F({user:r})}catch(e){w(e)}finally{C(!1),M(!1)}}if(!i||!r||!m)/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(t.ModalHeader,{onClose:b,backFn:P},"header"),/*#__PURE__*/e.jsx(l.AppLogoContainer,{children:/*#__PURE__*/e.jsx(u.MfaShieldIcon,{})}),/*#__PURE__*/e.jsx(l.Container,{children:/*#__PURE__*/e.jsx(n.Loader,{})}),/*#__PURE__*/e.jsx(t.ModalFooter,{})]});if("sms"===q)return null;if("totp"===q)/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(t.ModalHeader,{backFn:X,onClose:b},"header"),/*#__PURE__*/e.jsx(l.IconWrapper,{style:{marginBottom:"1.5rem"},children:/*#__PURE__*/e.jsx(d.default,{})}),/*#__PURE__*/e.jsx(l.Title,{children:"Remove authenticator app verification?"}),/*#__PURE__*/e.jsxs(l.SubTitle,{children:["MFA adds an extra layer of security to your ",m?.name," account. Make sure you have other methods to secure your account."]}),/*#__PURE__*/e.jsx(l.BottomSection,{children:/*#__PURE__*/e.jsx(t.PrimaryButton,{$warn:!0,onClick:async function(){try{w(void 0),C(!0);let e=await L();return await F({user:e})}catch(e){w(e)}finally{C(!1),y(null)}},loading:k,children:"Remove"})}),/*#__PURE__*/e.jsx(t.ModalFooter,{})]});if("passkey"===q){let r=c.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;/*#__PURE__*/return e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(t.ModalHeader,{backFn:X,onClose:b},"header"),/*#__PURE__*/e.jsx(l.IconWrapper,{style:{marginBottom:"1.5rem"},children:/*#__PURE__*/e.jsx(d.default,{})}),/*#__PURE__*/e.jsx(l.Title,{children:"Are you sure you want to remove this passkey?"}),/*#__PURE__*/e.jsx(l.SubTitle,{children:r?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),/*#__PURE__*/e.jsx(l.BottomSection,{children:/*#__PURE__*/e.jsx(t.PrimaryButton,{$warn:!0,onClick:async function(){try{w(void 0),C(!0);let e=await B([]);return await F({user:e})}catch(e){w(e)}finally{C(!1),y(null)}},loading:k,children:"Remove"})}),/*#__PURE__*/e.jsx(t.ModalFooter,{})]})}return 0!==T.length||W||H||U?"sms"===p?null:"totp"===p&&v?/*#__PURE__*/e.jsx(u.EnrollTotp,{onClose:b,onReset:X,submitEnrollmentWithTotp:e=>async function(e){try{w(void 0),C(!0);let r=await R(e);return await F({user:r})}catch(e){w(e)}finally{C(!1),y(null)}}(e.mfaCode),error:S,totpInfo:{...v,appName:m?.name||"Privy"}}):"passkey"===p?/*#__PURE__*/e.jsx(u.EnrollPasskey,{onReset:X,onClose:b,submitEnrollmentWithPasskey:$}):/*#__PURE__*/e.jsx(u.EnrollLandingScreen,{showIntro:!0,userMfaMethods:r.mfaMethods,appMfaMethods:m.mfa.methods,userHasAuthSms:D,backFn:P,handleSelectMethod:async function(e){w(void 0);try{await E()}catch(e){return void w(e)}return"totp"===e?(f(e),x(null),void A().then((({totpSecret:e,totpAuthUrl:r})=>{x({authUrl:r,secret:e})})).catch((()=>{x(null),X()}))):"passkey"===e&&1===O.length?await $():void f(e)},isTotpLoading:"totp"===p&&!v,isPasskeyLoading:g,error:S,onClose:b,setRemovingMfaMethod:async function(e){w(void 0);try{await E()}catch(e){return void w(e)}y(e)}}):/*#__PURE__*/e.jsxs(e.Fragment,{children:[/*#__PURE__*/e.jsx(t.ModalHeader,{onClose:b,backFn:P},"header"),/*#__PURE__*/e.jsx(l.IconWrapper,{style:{marginBottom:"1.5rem"},children:/*#__PURE__*/e.jsx(h.default,{})}),/*#__PURE__*/e.jsx(l.Title,{children:"Add more security"}),/*#__PURE__*/e.jsxs(l.SubTitle,{children:[m?.name," does not have any verification methods enabled."]}),/*#__PURE__*/e.jsx(l.BottomSection,{children:/*#__PURE__*/e.jsx(t.PrimaryButton,{onClick:b,children:"Close"})}),/*#__PURE__*/e.jsx(t.ModalFooter,{})]})}};exports.MfaAuthEnrollmentFlowScreen=j,exports.default=j;
