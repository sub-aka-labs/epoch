"use strict";var e=require("react/jsx-runtime"),r=require("react"),i=require("./context-BeSQM-Ma.js"),t=require("./get-is-unified-wallet-BwdzQwn_.js"),o=require("./to-ui-error-C4aac_aM.js");require("@privy-io/js-sdk-core"),require("tinycolor2"),require("viem"),require("./internal-context-BJv4f_bO.js"),require("ofetch"),require("@heroicons/react/24/outline/DevicePhoneMobileIcon"),require("@heroicons/react/24/outline/FingerPrintIcon"),require("@heroicons/react/24/outline/PhoneIcon"),require("@heroicons/react/24/outline/ShieldCheckIcon"),require("./ModalHeader-C5O9gNUP.js"),require("styled-components"),require("./useActiveWallet-vlXeDPzp.js"),require("zustand"),require("react-device-detect"),require("./prepareFundingModalData-DDf6xLze.js"),require("eventemitter3"),require("./events-context-Di6--rDg.js"),require("viem/utils"),require("./getPublicClient-BsmZyCGX.js"),require("./useWallets-DMyuB5aJ.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./ScreenLayout-BtVIYAso.js"),require("./Screen-BSwlHqPg.js"),require("./index-ByFhjjzH.js"),require("./PinInput-B12fA7pp.js"),require("@heroicons/react/24/outline/CalendarIcon"),require("@heroicons/react/24/outline/ExclamationTriangleIcon"),require("./StackedContainer-CM36po_U.js"),require("./useGetTokenPrice-DJpJnTij.js"),require("./useGetSolPrice-Ca32VAbF.js"),require("./index-CzmnSRoa.js"),require("uuid"),require("jose"),require("@coinbase/wallet-sdk"),require("@privy-io/ethereum"),require("mipd"),require("@privy-io/popup"),require("./paths-DizMb-lU.js"),require("./usePrivy-Bx2PKTrU.js"),require("@scure/base"),require("@headlessui/react"),require("@walletconnect/ethereum-provider"),require("@privy-io/urls"),require("js-cookie"),require("./frame-Oz7volks.js"),require("@privy-io/routes"),require("x402/client"),require("@privy-io/api-base"),require("viem/accounts"),require("./use-sign-with-user-signer-Cu_6Bx7m.js"),require("./getEmbeddedConnectedWallet-6TsVZJkD.js"),require("./TransactionDetails-DYow9ihU.js"),require("./WalletLink-CZLtiI7E.js"),require("./ethers-XrYC9HG-.js"),require("./getFormattedUsdFromLamports-Mu2fqwL2.js"),require("./transaction-DjF5X-by.js"),require("./Layouts-D3TOcPhm.js"),require("@heroicons/react/24/outline/ChevronDownIcon");const s={component:()=>{let{user:s}=t.usePrivyContext(),u=i.useAppConfig(),n=s?.mfaMethods.filter((e=>"passkey"!==e||!u.globalDisablePasskeys))??[],{data:a}=t.usePrivyModal(),[c,l]=r.useState(n[0]),[q,d]=r.useState(!1),[h,f]=r.useState(),[y,p]=r.useState();if(r.useEffect((()=>{l(n[0])}),[n]),!a?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:j,onSuccess:v,generateOptions:m,verifyTotpCode:k,verifyPasskey:g,verifySmsCode:S,sendSmsCode:w}=a.mfaVerify,C=async e=>{if("passkey"!==e)try{l(e),"sms"===e&&(l(e),await w()),"totp"===e&&l(e)}catch(e){console.error(e)}else try{l(e);let r=await m();if(!r)throw Error("something went wrong");f(r),await g(r),d(!0),p(void 0),v()}catch(e){p(o.toUIError(e))}},M=async e=>{p(void 0);try{if(!e||!c)return;if("passkey"===c){if(!h)throw Error("Missing passkey challenge");await g(h)}else"sms"===c?await S(e):"totp"===c&&await k(e);p(void 0),d(!0),v()}catch(e){throw o.toUIError(e).error}},I=()=>{y||!q?j(y?.error??Error("Canceled MFA verification.")):v()},x=r.useRef(!1);return r.useEffect((()=>{!x.current&&c&&(x.current=!0,C(c).finally((()=>{x.current=!1})))}),[open]),s?"passkey"===c?/*#__PURE__*/e.jsx(o.VerifyWithPasskey,{account:s.linkedAccounts.filter((e=>"passkey"===e.type&&e.enrolledInMfa)).sort(((e,r)=>r.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:q,hasBlockingError:y?.isBlocking??!1,error:y?.error,onClose:I,onBack:()=>{l(void 0),p(void 0)},handleSubmit:()=>M(h).catch(p)}):"sms"===c||"totp"===c?/*#__PURE__*/e.jsx(o.VerifyWithSmsOrTotpCode,{selectedMethod:c,submitSuccess:q,hasBlockingError:y?.isBlocking??!1,handleSubmitCode:M,onClose:I,onBack:n.length>1?()=>l(void 0):void 0}):/*#__PURE__*/e.jsx(o.VerifyMethodSelectionScreen,{mfaMethods:n,onSelect:C,handleClose:I}):null}};exports.MfaAuthVerifyFlowScreen=s,exports.default=s;
